<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <title>Spåra din beställning – Icefot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Inter, Arial, sans-serif;
        background: #f5f7fa;
      }

      .container {
        max-width: 650px;
        margin: 40px auto;
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
      }

      h1 {
        margin: 0 0 10px 0;
        font-size: 26px;
        font-weight: 600;
        color: #1a1a1a;
      }

      p {
        color: #555;
        margin: 0 0 15px 0;
        font-size: 15px;
      }

      .input-row {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      input {
        flex: 1;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #d2d6dc;
        font-size: 15px;
      }

      button {
        padding: 12px 20px;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        cursor: pointer;
        transition: 0.2s;
      }

      button:hover {
        background: #1e4fcc;
      }

      .result-box {
        margin-top: 25px;
        padding: 20px;
        border-radius: 10px;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
      }

      .label {
        font-weight: 600;
        color: #1f2937;
      }

      .timeline {
        margin-top: 20px;
        padding-left: 0;
        list-style: none;
      }

      .timeline li {
        padding: 10px 0;
        border-left: 3px solid #2563eb;
        margin-left: 10px;
        padding-left: 15px;
        position: relative;
      }

      .timeline li::before {
        content: "";
        width: 12px;
        height: 12px;
        background: #2563eb;
        border-radius: 50%;
        position: absolute;
        left: -7.5px;
        top: 14px;
      }

      .event-time {
        font-size: 13px;
        color: #6b7280;
      }

      .event-status {
        font-size: 15px;
        font-weight: 500;
        color: #111827;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>Spåra din beställning</h1>
      <p>Skriv in ditt 4PX-spårningsnummer nedan för att följa ditt paket.</p>

      <div class="input-row">
        <input id="tn" placeholder="Ex: 4PX3002244028809CN" />
        <button onclick="track()">Spåra</button>
      </div>

      <div id="result"></div>
    </div>

    <script>
      const API_URL = "https://track2-three.vercel.app/api/track";

      function formatDate(dt) {
        if (!dt) return "-";
        try {
          return new Date(dt).toLocaleString("sv-SE");
        } catch {
          return dt;
        }
      }

      async function track() {
        const tn = document.getElementById("tn").value.trim();
        const box = document.getElementById("result");

        if (!tn) {
          box.innerHTML = "<p>❌ Ange ett spårningsnummer.</p>";
          return;
        }

        box.innerHTML = "<p>⏳ Hämtar information...</p>";

        try {
          const res = await fetch(API_URL + "?tn=" + encodeURIComponent(tn));
          const data = await res.json();

          if (!data.ok) {
            box.innerHTML = "<p>❌ Kunde inte hämta spårning.</p>";
            return;
          }

          // Bygg HTML för resultatet
          let html = `<div class="result-box">`;

          html += `<p><span class="label">Spårningsnummer:</span> ${data.trackingNumber}</p>`;

          html += `<p><span class="label">Status:</span> ${data.statusSwedish || "-"}</p>`;

          if (data.postnordNumber) {
            html += `<p><span class="label">PostNord nr:</span> ${data.postnordNumber} <br>
            <a href="https://portal.postnord.com/tracking/details/${data.postnordNumber}" target="_blank">Öppna i PostNord</a></p>`;
          } else {
            html += `<p><span class="label">PostNord nr:</span> Ej tilldelat ännu</p>`;
          }

          html += `<p><span class="label">Senast uppdaterad:</span> ${formatDate(
            data.lastUpdate
          )}</p>`;

          // EVENTS – tidslinje
          if (data.events && data.events.length > 0) {
            html += `<h3>Händelser</h3>`;
            html += `<ul class="timeline">`;

            data.events.forEach((ev) => {
              html += `
                <li>
                  <div class="event-time">${formatDate(ev.time)}</div>
                  <div class="event-status">${
                    ev.milestoneSwedish || ev.rawStatus
                  }</div>
                </li>`;
            });

            html += `</ul>`;
          } else {
            html += `<p>Inga händelser ännu.</p>`;
          }

          html += `</div>`;

          box.innerHTML = html;
        } catch (err) {
          box.innerHTML =
            "<p>❌ Tekniskt fel. Försök igen senare.</p>" + err.message;
        }
      }
    </script>
  </body>
</html>
